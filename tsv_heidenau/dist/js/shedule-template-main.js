!function(){function e(e){this.element=e,this.timelineItems=this.element.getElementsByClassName("cd-schedule__timeline")[0].getElementsByTagName("li"),this.timelineStart=t(this.timelineItems[0].textContent),this.timelineUnitDuration=t(this.timelineItems[1].textContent)-t(this.timelineItems[0].textContent),this.topInfoElement=this.element.getElementsByClassName("cd-schedule__top-info")[0],this.singleEvents=this.element.getElementsByClassName("cd-schedule__event"),this.modal=this.element.getElementsByClassName("cd-schedule-modal")[0],this.modalHeader=this.element.getElementsByClassName("cd-schedule-modal__header")[0],this.modalHeaderBg=this.element.getElementsByClassName("cd-schedule-modal__header-bg")[0],this.modalBody=this.element.getElementsByClassName("cd-schedule-modal__body")[0],this.modalBodyBg=this.element.getElementsByClassName("cd-schedule-modal__body-bg")[0],this.modalClose=this.modal.getElementsByClassName("cd-schedule-modal__close")[0],this.modalDate=this.modal.getElementsByClassName("cd-schedule-modal__date")[0],this.modalEventName=this.modal.getElementsByClassName("cd-schedule-modal__name")[0],this.coverLayer=this.element.getElementsByClassName("cd-schedule__cover-layer")[0],this.modalMaxWidth=800,this.modalMaxHeight=480,this.animating=!1,this.supportAnimation=Util.cssSupports("transition"),this.initSchedule()}function t(e){var t=(e=e.replace(/ /g,"")).split(":");return 60*parseInt(t[0])+parseInt(t[1])}e.prototype.initSchedule=function(){this.scheduleReset(),this.initEvents()},e.prototype.scheduleReset=function(){var e=this.mq(),t=Util.hasClass(this.element,"js-schedule-loaded"),s=Util.hasClass(this.modal,"cd-schedule-modal--open");"desktop"!=e||t?"mobile"==e&&t?(Util.removeClass(this.element,"cd-schedule--loading js-schedule-loaded"),this.resetEventsStyle(),s&&this.checkEventModal()):"desktop"==e&&s?(this.checkEventModal(s),Util.removeClass(this.element,"cd-schedule--loading")):Util.removeClass(this.element,"cd-schedule--loading"):(Util.addClass(this.element,"js-schedule-loaded"),this.placeEvents(),s&&this.checkEventModal(s))},e.prototype.resetEventsStyle=function(){for(var e=0;e<this.singleEvents.length;e++)this.singleEvents[e].removeAttribute("style")},e.prototype.placeEvents=function(){for(var e=this,s=this.topInfoElement.offsetHeight,l=0;l<this.singleEvents.length;l++){var a=this.singleEvents[l].getElementsByTagName("a")[0],n=t(a.getAttribute("data-start")),i=t(a.getAttribute("data-end"))-n,o=s*(n-e.timelineStart)/e.timelineUnitDuration,d=s*i/e.timelineUnitDuration;this.singleEvents[l].setAttribute("style","top: "+(o-1)+"px; height: "+(d+1)+"px")}Util.removeClass(this.element,"cd-schedule--loading")},e.prototype.initEvents=function(){},e.prototype.openModal=function(e){var t=this,s=t.mq();if(this.animating=!0,this.modalEventName.textContent=e.getElementsByTagName("em")[0].textContent,this.modalDate.textContent=e.getAttribute("data-start")+" - "+e.getAttribute("data-end"),this.modal.setAttribute("data-event",e.getAttribute("data-event")),this.loadEventContent(e.getAttribute("data-content")),Util.addClass(this.modal,"cd-schedule-modal--open"),setTimeout((function(){Util.addClass(e.closest("li"),"cd-schedule__event--selected")}),10),"mobile"==s)t.modal.addEventListener("transitionend",(function e(){t.animating=!1,t.modal.removeEventListener("transitionend",e)}));else{var l=e.getBoundingClientRect(),a=l.top,n=l.left,i=e.offsetHeight,o=e.offsetWidth,d=window.innerWidth,m=window.innerHeight,r=.8*d>t.modalMaxWidth?t.modalMaxWidth:.8*d,h=.8*m>t.modalMaxHeight?t.modalMaxHeight:.8*m,c=parseInt((d-r)/2-n),u=parseInt((m-h)/2-a),g=h/i,p=r-o;t.modal.setAttribute("style","top:"+a+"px;left:"+n+"px;height:"+h+"px;width:"+r+"px;transform: translateY("+u+"px) translateX("+c+"px)"),t.modalHeader.setAttribute("style","width:"+o+"px"),t.modalBody.setAttribute("style","margin-left:"+o+"px"),t.modalBodyBg.setAttribute("style","height:"+i+"px; width: 1px; transform: scaleY("+g+") scaleX("+p+")"),t.modalHeaderBg.setAttribute("style","height: "+i+"px; width: "+o+"px; transform: scaleY("+g+")"),t.modalHeaderBg.addEventListener("transitionend",(function e(){t.animating=!1,Util.addClass(t.modal,"cd-schedule-modal--animation-completed"),t.modalHeaderBg.removeEventListener("transitionend",e)}))}this.animationFallback()},e.prototype.closeModal=function(){var e=this,t=e.mq(),s=e.element.getElementsByClassName("cd-schedule__event--selected")[0],l=s.getElementsByTagName("a")[0];if(this.animating=!0,"mobile"==t)Util.removeClass(this.modal,"cd-schedule-modal--open"),e.modal.addEventListener("transitionend",(function t(){Util.removeClass(e.modal,"cd-schedule-modal--content-loaded"),Util.removeClass(s,"cd-schedule__event--selected"),e.animating=!1,e.modal.removeEventListener("transitionend",t)}));else{var a=l.getBoundingClientRect(),n=a.top,i=a.left,o=l.offsetHeight,d=l.offsetWidth,m=window.getComputedStyle(e.modal),r=Number(m.getPropertyValue("top").replace("px","")),h=i-Number(m.getPropertyValue("left").replace("px","")),c=n-r;Util.removeClass(this.modal,"cd-schedule-modal--open cd-schedule-modal--animation-completed"),e.modal.style.width=d+"px",e.modal.style.height=o+"px",e.modal.style.transform="translateX("+h+"px) translateY("+c+"px)",e.modalBodyBg.style.transform="scaleX(0) scaleY(1)",e.modalHeaderBg.style.transform="scaleY(1)",e.modalHeaderBg.addEventListener("transitionend",(function t(){Util.addClass(e.modal,"cd-schedule-modal--no-transition"),setTimeout((function(){e.modal.removeAttribute("style"),e.modalBody.removeAttribute("style"),e.modalHeader.removeAttribute("style"),e.modalHeaderBg.removeAttribute("style"),e.modalBodyBg.removeAttribute("style")}),10),setTimeout((function(){Util.removeClass(e.modal,"cd-schedule-modal--no-transition")}),20),e.animating=!1,Util.removeClass(e.modal,"cd-schedule-modal--content-loaded"),Util.removeClass(s,"cd-schedule__event--selected"),e.modalHeaderBg.removeEventListener("transitionend",t)}))}this.animationFallback()},e.prototype.checkEventModal=function(e){this.animating=!0;var t=this,s=this.mq();if("mobile"==s)t.modal.removeAttribute("style"),t.modalBody.removeAttribute("style"),t.modalHeader.removeAttribute("style"),t.modalHeaderBg.removeAttribute("style"),t.modalBodyBg.removeAttribute("style"),Util.removeClass(t.modal,"cd-schedule-modal--no-transition"),t.animating=!1;else if("desktop"==s&&e){Util.addClass(t.modal,"cd-schedule-modal--no-transition cd-schedule-modal--animation-completed");var l=t.element.getElementsByClassName("cd-schedule__event--selected")[0].getElementsByTagName("a")[0],a=l.getBoundingClientRect(),n=(a.top,a.left,l.offsetHeight),i=l.offsetWidth,o=window.innerWidth,d=window.innerHeight,m=.8*o>t.modalMaxWidth?t.modalMaxWidth:.8*o,r=.8*d>t.modalMaxHeight?t.modalMaxHeight:.8*d,h=r/n,c=m-i;setTimeout((function(){t.modal.setAttribute("style","top:"+(d/2-r/2)+"px;left:"+(o/2-m/2)+"px;height:"+r+"px;width:"+m+"px;transform: translateY(0) translateX(0)"),t.modalBodyBg.style.height=r+"px",t.modalBodyBg.style.transform="scaleY(1) scaleX("+c+")",t.modalBodyBg.style.width="1px",t.modalHeader.setAttribute("style","width:"+i+"px"),t.modalBody.setAttribute("style","margin-left:"+i+"px"),t.modalHeaderBg.setAttribute("style","height: "+n+"px;width:"+i+"px; transform:scaleY("+h+");")}),10),setTimeout((function(){Util.removeClass(t.modal,"cd-schedule-modal--no-transition"),t.animating=!1}),20)}},e.prototype.loadEventContent=function(e){var t=this;httpRequest=new XMLHttpRequest,httpRequest.onreadystatechange=function(){httpRequest.readyState===XMLHttpRequest.DONE&&200===httpRequest.status&&(t.modal.getElementsByClassName("cd-schedule-modal__event-info")[0].innerHTML=t.getEventContent(httpRequest.responseText),Util.addClass(t.modal,"cd-schedule-modal--content-loaded"))},httpRequest.open("GET",e+".html"),httpRequest.send()},e.prototype.getEventContent=function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.getElementsByClassName("cd-schedule-modal__event-info")[0].innerHTML},e.prototype.animationFallback=function(){if(!this.supportAnimation){var e=new CustomEvent("transitionend");self.modal.dispatchEvent(e),self.modalHeaderBg.dispatchEvent(e)}},e.prototype.mq=function(){return window.getComputedStyle(this.element,"::before").getPropertyValue("content").replace(/'|"/g,"")};var s=document.getElementsByClassName("js-cd-schedule"),l=[],a=!1;if(s.length>0){for(var n=0;n<s.length;n++)!function(t){l.push(new e(s[t]))}(n);function i(){for(var e=0;e<l.length;e++)l[e].scheduleReset();a=!1}window.addEventListener("resize",(function(e){a||(a=!0,window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,250))})),window.addEventListener("keyup",(function(e){if(e.keyCode&&27==e.keyCode||e.key&&"escape"==e.key.toLowerCase())for(var t=0;t<l.length;t++)l[t].closeModal()}))}}();
