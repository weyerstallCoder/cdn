var $p=function(){var e=arguments,t=e[0],n=!1;return"string"==typeof t?n=e[1]||!1:!t||t[0]||t.length||(t=[t]),$p.core(t,n)},pure=$p;$p.core=function(e,t,n){function r(e){throw"undefined"!=typeof console&&console.log(e),"pure error: "+e}function o(e){return e.outerHTML||(t=e,(n=document.createElement("div")).appendChild(t.cloneNode(!0)),n.innerHTML);var t,n}function i(e,t){return function(n){return e(String(t.call(n.item||n.context,n)))}}function u(e,t){return"string"==typeof e&&(t=e,e=!1),(e||document).querySelectorAll(t)}function s(e,t){return function(n){var r,o,i,u,s,c=[e[0]],l=e.length;try{for(s=1;s<l;s++)r=t[s].call(this,n),o=e[s],""===r&&(u=(i=c[c.length-1]).search(/[^\s]+=\"?$/))>-1&&(c[c.length-1]=i.substring(0,u),o=o.substr(1)),c[c.length]=r,c[c.length]=o;return c.join("")}catch(e){return console&&console.log&&console.log(e.stack||e.message+" ("+e.type+(e.arguments?", "+e.arguments.join("-"):"")+"). Use Firefox or Chromium/Chrome to get a full stack of the error. "),""}}}function c(e){if("function"==typeof e)return function(t){return(t=e.call(t.item||t.context||t,t))||0===t?t:""};var t,n=e.match(/^[\da-zA-Z\$_\@\#][\w\$:\-\#]*(\.[\w\$:\-\#]*[^\.])*$/),r=!1,o=e,i=[],u=[],l=0;if(null===n){if(/\'|\"/.test(o.charAt(0))){if(/\'|\"/.test(o.charAt(o.length-1)))return t=o.substring(1,o.length-1),function(){return t}}else for(;null!==(n=o.match(/#\{([^{}]+)\}/));)r=!0,i[l++]=o.slice(0,n.index),u[l]=c(n[1]),o=o.slice(n.index+n[0].length,o.length);return r?(i[l]=o,s(i,u)):function(){return e}}return n=e.split("."),function(e){var t,r=e.context||e,o=e[n[0]];if(e=0,o&&void 0!==o.item){if("pos"===n[e+=1])return o.pos;r=o.item}for(o=n.length;e<o&&r;)r="function"==typeof(t=r[n[e]])?t.call(r):t,e++;return r||0===r?r:""}}function l(e,t,i){var u,s,c,l,f,p,a,d,h,m,y=[];if("string"==typeof t){if(u=t,(f=t.match(_))||r("bad selector syntax: "+t),s=f[1],c=f[2],l=f[3],f=f[4],"."===c||!c&&l?y[0]=e:y=n.find(e,c),!y||0===y.length)return r('The node "'+t+'" was not found in the template:\n'+o(e).replace(/\t/g,"  "))}else s=t.prepend,l=t.attr,f=t.append,y=[e];return(s||f)&&(s&&f?r("append/prepend cannot take place at the same time"):i?r("no append/prepend/replace modifiers allowed for loop target"):f&&i&&r("cannot append with loop (sel: "+u+")")),l?(d=/^style$/i.test(l),m=(h=/^class$/i.test(l))?"className":l,p=function(e,t){if(e.setAttribute(N+l,t),e[m]&&!d)try{e[m]=""}catch(e){}1===e.nodeType&&(e.removeAttribute(l),h&&e.removeAttribute(m))},a=d||h?d?function(e){return e.style.cssText}:function(e){return e.className}:function(e){return e.getAttribute(l)},e=function(e){return e.replace(/\"/g,"&quot;")},s=s?function(e,t){p(e,t+a(e))}:f?function(e,t){p(e,a(e)+t)}:function(e,t){p(e,t)}):(s=i?function(e,t){var n=e.parentNode;n?(n.insertBefore(document.createTextNode(t),e.nextSibling),n.removeChild(e)):r("The template root, can't be looped.")}:s?function(e,t){e.insertBefore(document.createTextNode(t),e.firstChild)}:f?function(e,t){e.appendChild(document.createTextNode(t))}:function(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))},e=function(e){return e}),{attr:l,nodes:y,set:s,sel:u,quotefn:e}}function f(e,t){var n,r=x+t+":";for(n=0;n<e.nodes.length;n++)e.set(e.nodes[n],r)}function p(e,t,n,o,i){return function(u){var s,c,l=t(u),f=u[e],p={items:l},a=0,d=[],h=function(e,t,r,o){var i=u.pos,s=u.item,c=u.items;u.pos=t.pos=e,u.item=t.item=l[e],u.items=l,void 0!==o&&(u.length=o),"function"==typeof r&&!1===r.call(u.item,u)?a++:(d.push(n.call(u.item,u)),u.pos=i,u.item=s,u.items=c)};if(u[e]=p,O(l))for(s=l.length||0,"function"==typeof o&&l.sort((function(e,t){return o.call(u,e,t)})),c=0;c<s;c++)h(c,p,i,s-a);else for(s in l&&void 0!==o&&r("sort is only available on arrays, not objects"),l)l.hasOwnProperty(s)&&h(s,p,i);return void 0!==f?u[e]=f:delete u[e],d.join("")}}function a(e,t,n,o){var u,s,h,m,y,g=!1;for(m in n)n.hasOwnProperty(m)&&("sort"===m?s=n.sort:"filter"===m?h=n.filter:g?r("cannot have more than one loop on a target"):(u=m,g=!0));if(u||r("Error in the selector: "+t+"\nA directive action must be a string, a function or a loop(<-)"),"string"==typeof(g=n[u])||"function"==typeof g)return(n={})[u]={root:g},a(e,t,n,o);for(n=function(e){var t=e.match(/^(\w+)\s*<-\s*(\S+)?$/);return null===t&&r('bad loop spec: "'+e+'"'),"item"===t[1]&&r('"item<-..." is a reserved word for the current running iteration.\n\nPlease choose another name for your loop.'),t[2]&&"context"!==t[2].toLowerCase()?t[2]&&0===t[2].indexOf("context")&&(t[2]=c(t[2].replace(/^context\.?/,""))):t[2]=function(e){return e.context},{name:t[1],sel:t[2]}}(u),u=c(n.sel),t=(e=l(e,t,!0)).nodes,v=0;v<t.length;v++)y=d(m=t[v],g),o[o.length]=i(e.quotefn,p(n.name,u,y,s,h)),e.nodes=[m],f(e,o.length-1);return e}function d(e,t,n,r){var u,h,m,y,g,v,$,T,b,E=[],C=[];if(r=r||n&&function(e,t){function n(e,n){var r,o,i,u=e.match(_);for(u={prepend:!!u[1],prop:u[2],attr:u[3]||A[n],append:!!u[4],sel:e},r=h.a.length-1;r>=0;r--)if(void 0!==(i=(i=(o=h.a[r]).l[0])&&i[u.prop])){u.prop=o.p+"."+u.prop,!0===h.l[u.prop]&&(i=i[0]);break}return(void 0!==i||""!==(i=c(u.prop)(O(t)?t[0]:t)))&&(O(i)?(h.a.push({l:i,p:u.prop}),h.l[u.prop]=!0,u.t="loop"):u.t="str",u)}var r,o,i,u,s,l,f,p,a=e.getElementsByTagName("*"),d=[],h={a:[],l:{}};for(i=-1,u=a.length;i<u;i++)if(1===(f=i>-1?a[i]:e).nodeType&&""!==f.className)for(s=0,l=(p=f.className.split(" ")).length;s<l;s++)!1!==(r=n(r=p[s],f.tagName))&&(o=/nodevalue/i.test(r.attr),(r.sel.indexOf("@")>-1||o)&&(f.className=f.className.replace("@"+r.attr,""),o&&(r.attr=!1)),d.push({n:f,cspec:r}));return d}(e,n),n)for(;r.length>0;)if(m=r[0].cspec,y=r[0].n,r.splice(0,1),"str"===m.t)f(y=l(y,m,!1),E.length),E[E.length]=i(y.quotefn,c(m.prop));else for(v=c(m.sel),u=0,h=(g=(y=l(y,m,!0)).nodes).length;u<h;u++)T=d($=g[u],!1,n,r),E[E.length]=i(y.quotefn,p(m.sel,v,T)),y.nodes=[$],f(y,E.length-1);for(b in t)if(t.hasOwnProperty(b)){n=0,r=t[b],v=(m=b.split(/\s*,\s*/)).length;do{"function"==typeof r||"string"==typeof r?(f(y=l(e,b=m[n],!1),E.length),E[E.length]=i(y.quotefn,c(r))):a(e,b,r,E)}while(++n<v)}for(e=(e=(e=(e=o(e)).replace(/<([^>]+)\s(value\=""|selected)\s?([^>]*)>/gi,"<$1 $3>")).split(N).join("")).split(x),n=1;n<e.length;n++)t=e[n],C[n]=E[parseInt(t,10)],e[n]=t.substring(t.indexOf(":")+1);return s(e,C)}function h(e,t,n){var r=d((n||this[0]).cloneNode(!0),e,t);return function(e){return r({context:e})}}function m(e,t){var r,o,i="function"==typeof t&&t;for(r=0,o=this.length;r<o;r++)this[r]=g(this[r],(i||n.compile(t,!1,this[r]))(e,!1));return this}function y(e,t){var r,o,i=n.compile(t,e,this[0]);for(r=0,o=this.length;r<o;r++)this[r]=g(this[r],i(e,!1));return this}function g(e,t){var n,r,o=e.parentNode,i=0;switch(o||(o=document.createElement("DIV")).appendChild(e),e.tagName){case"BODY":return o.removeChild(e),o.innerHTML+=t,o.getElementsByTagName("BODY")[0];case"TBODY":case"THEAD":case"TFOOT":t="<TABLE>"+t+"</TABLE>",i=1;break;case"TR":t="<TABLE><TBODY>"+t+"</TBODY></TABLE>",i=2;break;case"TD":case"TH":t="<TABLE><TBODY><TR>"+t+"</TR></TBODY></TABLE>",i=3;break;case"OPTGROUP":case"OPTION":t="<SELECT>"+t+"</SELECT>",i=1}for((r=document.createElement("SPAN")).style.display="none",document.body.appendChild(r),r.innerHTML=t,n=r.firstChild;i--;)n=n.firstChild;return o.insertBefore(n,e),o.removeChild(e),document.body.removeChild(r),n}var v,$,T,b=[],x="_s"+Math.floor(1e6*Math.random())+"_",N="_a"+Math.floor(1e6*Math.random())+"_",_=/^(\+)?([^\@\+]+)?\@?([^\+]+)?(\+)?$/,A={IMG:"src",INPUT:"value"},O=Array.isArray?function(e){return Array.isArray(e)}:function(e){return"[object Array]"===Object.prototype.toString.call(e)};switch(n=n||($=$p.plugins,((T=function(){}).prototype=$).compile=$.compile||h,T.prototype.render=$.render||m,T.prototype.autoRender=$.autoRender||y,T.prototype.find=$.find||u,T.prototype._compiler=d,T.prototype._error=r,new T),typeof e){case"string":0===(b=n.find(t||document,e)).length&&r('The template "'+e+'" was not found');break;case"undefined":r("The root of the template is undefined, check your selector");break;default:b=e}for(v=0,e=b.length;v<e;v++)n[v]=b[v];return n.length=e,n},$p.plugins={},$p.libs={dojo:function(){return function(e,t){return dojo.query(t,e)}},domassistant:function(){return DOMAssistant.attach({publicMethods:["compile","render","autoRender"],compile:function(e,t){return $p([this]).compile(e,t)},render:function(e,t){return $($p([this]).render(e,t))[0]},autoRender:function(e,t){return $($p([this]).autoRender(e,t))[0]}}),function(e,t){return $(e).cssSelect(t)}},ext:function(){return function(e,t){return Ext.query(t,e)}},jquery:function(){return jQuery.fn.extend({directives:function(e){return this._pure_d=e,this},compile:function(e,t){return $p(this).compile(this._pure_d||e,t)},render:function(e,t){return jQuery($p(this).render(e,this._pure_d||t))},autoRender:function(e,t){return jQuery($p(this).autoRender(e,this._pure_d||t))}}),function(e,t){return jQuery(e).find(t)}},mootools:function(){return Element.implement({compile:function(e,t){return $p(this).compile(e,t)},render:function(e,t){return $p([this]).render(e,t)},autoRender:function(e,t){return $p([this]).autoRender(e,t)}}),function(e,t){return $(e).getElements(t)}},prototype:function(){return Element.addMethods({compile:function(e,t,n){return $p([e]).compile(t,n)},render:function(e,t,n){return $p([e]).render(t,n)},autoRender:function(e,t,n){return $p([e]).autoRender(t,n)}}),function(e,t){return"string"==typeof(e=e===document?e.body:e)?$$(e):$(e).select(t)}},sizzle:function(){return function(e,t){return Sizzle(t,e)}},sly:function(){return function(e,t){return Sly(t,e)}},yui:function(){return void 0===document.querySelector&&YUI().use("node",(function(e){$p.plugins.find=function(t,n){return e.NodeList.getDOMNodes(e.one(t).all(n))}})),YUI.add("pure-yui",(function(e){e.Node.prototype.directives=function(e){return this._pure_d=e,this},e.Node.prototype.compile=function(e,t){return $p([this._node]).compile(this._pure_d||e,t)},e.Node.prototype.render=function(t,n){return e.one($p([this._node]).render(t,this._pure_d||n))},e.Node.prototype.autoRender=function(t,n){return e.one($p([this._node]).autoRender(t,this._pure_d||n))}}),"0.1",{requires:["node"]}),!0}},function(){var e,t=("undefined"!=typeof dojo?"dojo":"undefined"!=typeof DOMAssistant&&"domassistant")||"undefined"!=typeof Ext&&"ext"||"undefined"!=typeof jQuery&&"jquery"||"undefined"!=typeof MooTools&&"mootools"||"undefined"!=typeof Prototype&&"prototype"||"undefined"!=typeof Sizzle&&"sizzle"||"undefined"!=typeof Sly&&"sly"||"undefined"!=typeof YUI&&"yui";if(t&&(e=$p.libs[t]()),void 0===document.querySelector)if("function"==typeof e)$p.plugins.find=e;else if(!e)throw"you need a JS library with a CSS selector engine";"undefined"!=typeof exports&&(exports.$p=$p)}();
